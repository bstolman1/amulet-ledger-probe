name: Fetch ACS Snapshot

on:
  workflow_dispatch: # Manual trigger
  schedule:
    - cron: '0 */3 * * *' # Every 3 hours starting at 00:00 UTC (00:00, 03:00, 06:00, 09:00, 12:00, 15:00, 18:00, 21:00)

jobs:
  trigger-snapshot:
    runs-on: ubuntu-latest
    
    steps:
      - name: Invoke backend snapshot function
        run: |
          set -e
          echo "Triggering ACS snapshot..."
          RESP=$(curl -sS -X POST \
            -H "Authorization: Bearer $SUPABASE_ANON_KEY" \
            -H "apikey: $SUPABASE_ANON_KEY" \
            "$SUPABASE_URL/functions/v1/fetch-acs-snapshot")
          echo "Response: $RESP"
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
